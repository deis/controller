language: python
python:
  - 3.5
branches:
  only:
    - master
services:
  - docker
  - postgresql
sudo: required
addons:
  postgresql: "9.4"
before_install:
  - wget "http://ftp.debian.org/debian/pool/main/s/shellcheck/shellcheck_0.3.7-5_amd64.deb"
  - sudo dpkg -i shellcheck_0.3.7-5_amd64.deb
  - createdb -U postgres deis
install:
  - pip install -r rootfs/requirements.txt
  - pip install -r rootfs/dev_requirements.txt
script:
  - make test
after_success:
  - pushd rootfs/ && codecov && popd
deploy:
  - provider: script
    # ensure client/doc builds aren't removed
    # see https://docs.travis-ci.com/user/deployment/#Uploading-Files
    skip_cleanup: true
    script: _scripts/deploy.sh
    on:
      branch: master
notifications:
  webhooks:
    urls:
      - secure: "FnxmxLYI0JNavYOma3ZZamaY8cTCjaMDPz5RoWu1NG9l3k3xTkkXpHT5qcnQHycyCtVb8rNIoVMzdtyrs3BlVTaWdrzP/J2sJoc8/1NvuOZCTS0D1EbjS7DGV3xENDdSdTylOUWeFzti8dD3ORZ/bbdCHkMiVi3MIxlAQANWq8k="
    on_success: always
    on_failure: never
    on_start: never
